class FlashMessageManager{static DEFAULT_OPTIONS={limit:0,debug:!1};static bag=[];static displayed=[];static _displayQueue=0;constructor(s,e){this.options=FlashMessageManager.DEFAULT_OPTIONS,this.singleMessage=this.formatMessage(s,e),this.checkLimit()}genNewID(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(s=>(s^crypto.getRandomValues(new Uint8Array(1))[0]&15>>s/4).toString(16)))}formatMessage(s,e){if(s||e){return{message:s,flashOptions:e,id:this.genNewID()}}return null}checkLimit(){if(null!==this.singleMessage&&FlashMessageManager.bag.push(this),0===FlashMessageManager.bag.length)return void this.garbageCollection();if(FlashMessageManager._displayQueue>=this.options.limit&&this.options.limit>0)return void(this.options.debug&&console.log("Display limit ("+this.options.limit+") reached, queueing message, bag is holding: "+(FlashMessageManager.bag.length-this.options.limit)+" messages."));const s=FlashMessageManager.bag.find((s=>!FlashMessageManager.displayed.includes(s.singleMessage.id)));s?(this.options.debug&&console.log("Displaying message:",s.singleMessage),FlashMessageManager.create(s.singleMessage),FlashMessageManager.displayed.push(s.singleMessage.id)):this.options.debug&&console.log("Can not find more messages, the bag is probably empty, waiting for confirmation.")}garbageCollection(){this.options.debug&&console.log("Confirmation, bag is empty, garbage collection started."),FlashMessageManager.bag=[],FlashMessageManager.displayed=[],FlashMessageManager._displayQueue=0}static create(s){FlashMessageManager._displayQueue++,new FlashMessage(s.message,s.flashOptions,s.id)}}class FlashMessage{static get DEFAULT_OPTIONS(){return{type:"default",thumb:null,progress:!1,interactive:!0,timeout:8e3,appear_delay:200,remove_delay:600,container:".flash-container",classes:{container:"flash-container",visible:"flash-is-visible",flash:"flash-message",progress:"flash-progress",progress_hidden:"flash-is-hidden"},theme:"default",layout:"top-right",onShow:null,onClick:null,onClose:null}}constructor(s,e,t){this.$_element=null,this.$_message=null,this.interval=null,this.progress_bar=null,this.options={},this.message=s,this.setOptions(e),this.$_container=document.querySelector(this.options.container)||null,this._c_timeout=null,this.$_progress=null,this._progress_value=0,this.$_id=t,this.createContainer(),this.createMessage()}setOptions(s={}){return this.options=Object.assign({},FlashMessage.DEFAULT_OPTIONS,s),this.options}createContainer(){null!==this.$_container&&document.body.contains(this.$_container)||(this.$_container=document.createElement("div"),this.$_container.classList.add(this.options.classes.container),document.body.firstChild?document.body.insertBefore(this.$_container,document.body.firstChild):document.body.appendChild(this.$_container),this.$_container.setAttribute("aria-label","Notification list"),this.$_container.setAttribute("aria-live","polite"),this.$_container.tabIndex=0,this.$_container.classList.add(`${this.options.layout}-flash-layout`))}createMessage(){if(this.$_element=document.createElement("div"),this.$_element.classList.add(this.options.classes.flash,"flash-"+this.options.type),this.$_element.setAttribute("data-reference",this.$_id),this.$_message=document.createElement("span"),this.$_message.classList.add("flash-text"),this.$_message.innerHTML=this.message,this.$_element.appendChild(this.$_message),this.options.thumb){let s=document.createElement("img");s.classList.add("flash-thumb"),s.src=this.options.thumb,this.$_element.classList.add("flash-message-has-thumb"),this.$_element.appendChild(s)}this.$_element.classList.add(`${this.options.theme}-theme`),window.setTimeout((()=>{this.$_element.classList.add(this.options.classes.visible),this.run()}),this.options.appear_delay),this.isInteractive()&&this.bindEvents(),this.$_element.setAttribute("aria-live","polite"),this.$_element.setAttribute("aria-label",this.message),this.$_element.tabIndex=1,this.$_container.appendChild(this.$_element)}run(){this.startProgress(),this.hasProgress()&&(this._c_timeout=window.setTimeout((()=>this.close()),this.options.timeout))}stop(){null!==this._c_timeout&&(window.clearTimeout(this._c_timeout),this.stopProgress(),this._c_timeout=null)}close(){this.$_element.remove();const s=$(this.options.container);0===s.children().length&&s.remove(),FlashMessageManager._displayQueue--,FlashMessageManager.bag=FlashMessageManager.bag.filter((s=>s.singleMessage.id!==this.$_id)),new FlashMessageManager}bindEvents(){this.bindEvent("mouseover",(s=>this.stop())),this.bindEvent("mouseleave",(s=>this.run())),this.bindEvent("click",(s=>this.close()))}unbindEvents(){this.unbindEvent("mouseover",(s=>this.stop())),this.unbindEvent("mouseleave",(s=>this.run())),this.unbindEvent("click",(s=>this.close()))}bindEvent(s,e){this.$_element.addEventListener(s,e,!1)}unbindEvent(s,e){this.$_element.removeEventListener(s,e,!1)}isInteractive(){return this.options.interactive||this.$_element.classList.add("flash-not-interactive"),this.options.interactive}hasProgress(){return Boolean(this.options.progress)}progressBar(){this.$_progress=document.createElement("div"),this.$_progress.classList.add(this.options.classes.progress),this.$_progress.setAttribute("role","progressbar"),this.$_progress.setAttribute("aria-valuemin",0),this.$_progress.setAttribute("aria-valuemax",100),this.$_element.appendChild(this.$_progress)}setProgress(){const s=Date.now()-this._progress_starttime,e=Math.min(1,s/this.options.timeout),t=(100*e).toFixed(2);this.$_progress.setAttribute("aria-valuenow",t),this.$_progress.style.width=t+"%",this._progress_value=t,e>=1?this.stopProgress():requestAnimationFrame(this.setProgress.bind(this))}startProgress(){this.hasProgress()&&(this.$_progress||this.progressBar(),this.stopProgress(),this._progress_starttime=Date.now(),this.$_progress.classList.remove(this.options.classes.progress_hidden),this.setProgress())}stopProgress(){this.hasProgress()&&this.$_progress&&(this.$_progress.classList.add("flash-is-hidden"),this._progress_value=0)}}window.FlashMessageManager=FlashMessageManager,Macro.add("flash",{tags:["progress","Progress","interactive","Interactive","timeout","Timeout","delay","Delay","container","Container","theme","Theme","thumb","Thumb","classContainer","classcontainer","classFlash","classflash","classVisible","classvisible","classProgress","classprogress","classHidden","classhidden","flashtype","flashType","layout","Layout","transition","Transition"],handler:function(){const s=["top-right","middle-right","bottom-right","middle-bottom","bottom-left","middle-left","top-left","middle-top"],e=[],t={type:"default",thumb:null,progress:!0,interactive:!0,timeout:8e3,appear_delay:200,container:".flash-container",theme:"default",layout:"top-right",classes:{container:"flash-container",flash:"flash-message",visible:"flash-is-visible",progress:"flash-progress",progress_hidden:"flash-is-hidden"}};if(this.args.length<=0)return this.error('First argument cannot be skipped, please insert a string via <<flash "Text here.">>.');if(""===this.args[0])return this.error("First argument cannot be an empty string.");for(const a of this.payload)switch(a.name.toLowerCase()){case"flashtype":"string"!=typeof a.args[0]&&e.push("Type must be a string."),t.type=a.args[0];break;case"thumb":"string"!=typeof a.args[0]&&e.push("Thumb must be a string."),t.thumb=a.args[0];break;case"layout":"string"!=typeof a.args[0]&&e.push("Layout must be a string."),s.includes(a.args[0])||e.push("Layout does not include: "+a.args[0]),t.layout=a.args[0];break;case"progress":"boolean"!=typeof a.args[0]&&e.push("Progress must be true or false."),t.progress=a.args[0];break;case"interactive":"boolean"!=typeof a.args[0]&&e.push("Interactive must be true or false."),t.interactive=a.args[0];break;case"timeout":"number"!=typeof a.args[0]&&e.push("Timeout must be a number."),a.args[0]<500&&e.push("Timeout cannot be lower than 500ms."),a.args[0]>1e5&&e.push("Timeout cannot be higher than 100s."),t.timeout=a.args[0];break;case"delay":"number"!=typeof a.args[0]&&e.push("Delay must be a number."),a.args[0]<50&&e.push("Delay cannot be lower than 50ms."),a.args[0]>1e5&&e.push("Delay cannot be higher than 100s."),t.appear_delay=a.args[0];break;case"container":$("."+a.args[0]).length||e.push("Container not found."),t.container=a.args[0];break;case"theme":"string"!=typeof a.args[0]&&e.push("Theme must be a string."),"dark"!==a.args[0]&&e.push('The only theme option is "dark".'),t.theme=a.args[0];break;case"classcontainer":"string"!=typeof a.args[0]&&e.push("Class must be a string."),t.classes.container=a.args[0];break;case"classflash":"string"!=typeof a.args[0]&&e.push("Class must be a string."),t.classes.flash=a.args[0];break;case"classvisible":"string"!=typeof a.args[0]&&e.push("Class must be a string."),t.classes.visible=a.args[0];break;case"classprogress":"string"!=typeof a.args[0]&&e.push("Class must be a string."),t.classes.progress=a.args[0];break;case"classhidden":"string"!=typeof a.args[0]&&e.push("Class must be a string."),t.classes.progress_hidden=a.args[0];break;case"transition":"boolean"!=typeof a.args[0]&&e.push("Transition must be true or false."),a.args[0]&&$(document).one(":passagestart",(function(s){$(t.container).remove()}))}if(e.length>0)return this.error(e.join("\n"));new FlashMessageManager(this.args[0],{type:t.type,thumb:t.thumb,progress:t.progress,interactive:t.interactive,timeout:t.timeout,appear_delay:t.appear_delay,container:t.container,theme:t.theme,layout:t.layout,classes:{container:t.classes.container,flash:t.classes.flash,visible:t.classes.visible,progress:t.classes.progress,progress_hidden:t.classes.progress_hidden}})}});